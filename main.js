/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var L=Object.defineProperty;var z=Object.getOwnPropertyDescriptor;var U=Object.getOwnPropertyNames;var K=Object.prototype.hasOwnProperty;var G=(o,s)=>{for(var e in s)L(o,e,{get:s[e],enumerable:!0})},q=(o,s,e,i)=>{if(s&&typeof s=="object"||typeof s=="function")for(let t of U(s))!K.call(o,t)&&t!==e&&L(o,t,{get:()=>s[t],enumerable:!(i=z(s,t))||i.enumerable});return o};var Y=o=>q(L({},"__esModule",{value:!0}),o);var ee={};G(ee,{default:()=>E});module.exports=Y(ee);var p=require("obsidian");var h=require("obsidian");var B=require("obsidian"),J=24*60*60*1e3,w=class{constructor(){this.status={valid:!1,tier:"free",lastChecked:0}}isPro(){return this.status.valid&&this.status.tier==="pro"}getStatus(){return{...this.status}}async validate(s,e){if(!s||s.trim().length===0)return this.status={valid:!1,tier:"free",lastChecked:Date.now()},this.status;if(e&&e.valid&&Date.now()-e.lastChecked<J)return this.status=e,this.status;try{let i=await this.validateWithAPI(s);return this.status=i,i}catch(i){return e&&e.valid?(this.status=e,this.status):(this.status={valid:!1,tier:"free",lastChecked:Date.now()},this.status)}}async validateWithAPI(s){var i,t;let e=await(0,B.requestUrl)({url:"https://api.gumroad.com/v2/licenses/verify",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`product_id=nrwpa&license_key=${encodeURIComponent(s)}`});if(e.status===200){let n=e.json;if(n.success&&!((i=n.purchase)!=null&&i.refunded)&&!((t=n.purchase)!=null&&t.chargebacked))return{valid:!0,tier:"pro",lastChecked:Date.now()}}return{valid:!1,tier:"free",lastChecked:Date.now()}}},f={maxDigestCount:3,maxExcludedFolders:2,fullHealthDetails:!1};var $={digestCount:5,minDaysOld:7,excludedFolders:[],showDigestOnStartup:!0,licenseKey:"",licenseStatus:null},b=class extends h.PluginSettingTab{constructor(s,e){super(s,e),this.plugin=e}display(){let{containerEl:s}=this;s.empty(),s.createEl("h2",{text:"Vault Recall Settings"}),this.renderLicenseSection(s);let e=this.plugin.isPro(),i=e?15:f.maxDigestCount;new h.Setting(s).setName("Daily digest count").setDesc(e?"Number of forgotten notes to resurface each day":`Number of forgotten notes to resurface each day (Free: max ${f.maxDigestCount})`).addSlider(n=>n.setLimits(1,i,1).setValue(Math.min(this.plugin.settings.digestCount,i)).setDynamicTooltip().onChange(async r=>{this.plugin.settings.digestCount=r,await this.plugin.saveSettingsOnly()})),new h.Setting(s).setName("Minimum note age (days)").setDesc("Only resurface notes that haven't been modified for at least this many days").addSlider(n=>n.setLimits(1,90,1).setValue(this.plugin.settings.minDaysOld).setDynamicTooltip().onChange(async r=>{this.plugin.settings.minDaysOld=r,await this.plugin.saveSettingsOnly()}));let t=e?1/0:f.maxExcludedFolders;new h.Setting(s).setName("Excluded folders").setDesc(e?"Search and select folders to exclude from indexing":`Search and select folders to exclude (Free: max ${f.maxExcludedFolders})`),this.renderFolderPicker(s,t),new h.Setting(s).setName("Show digest on startup").setDesc("Automatically show the daily digest when Obsidian opens").addToggle(n=>n.setValue(this.plugin.settings.showDigestOnStartup).onChange(async r=>{this.plugin.settings.showDigestOnStartup=r,await this.plugin.saveSettingsOnly()}))}renderLicenseSection(s){if(this.plugin.isPro())new h.Setting(s).setName("\u2705 Vault Recall Pro").setDesc("All premium features are unlocked").addButton(i=>i.setButtonText("Deactivate").onClick(async()=>{this.plugin.settings.licenseKey="",this.plugin.settings.licenseStatus=null,await this.plugin.saveSettingsOnly(),this.plugin.deactivateLicense(),this.display()}));else{let i=document.createDocumentFragment();i.append("Enter your license key to unlock all premium features. ");let t=i.createEl("a",{text:"Get a license key \u2192",href:"https://vastavanjali.gumroad.com/l/nrwpa"}),n=new h.Setting(s).setName("\u{1F511} Activate Pro").setDesc(i),r="";n.addText(a=>a.setPlaceholder("XXXX-XXXX-XXXX-XXXX").setValue(this.plugin.settings.licenseKey).onChange(l=>{r=l})),n.addButton(a=>a.setButtonText("Activate").setCta().onClick(async()=>{if(!r.trim()){new h.Notice("Please enter a license key");return}a.setButtonText("Checking\u2026"),a.setDisabled(!0),this.plugin.settings.licenseKey=r.trim(),(await this.plugin.activateLicense(r.trim())).valid?new h.Notice("\u{1F389} Vault Recall Pro activated!"):(new h.Notice("\u274C Invalid license key. Please try again."),this.plugin.settings.licenseKey=""),await this.plugin.saveSettingsOnly(),this.display()}))}}renderFolderPicker(s,e){let i=s.createDiv({cls:"vr-folder-picker"}),t=this.plugin.settings.excludedFolders.length>=e,r=i.createDiv({cls:"vr-folder-search-row"}).createEl("input",{type:"text",placeholder:t?"Upgrade to Pro for more folders":"Search folders...",cls:"vr-folder-search-input"});t&&(r.disabled=!0);let a=i.createDiv({cls:"vr-folder-dropdown"});a.hide();let l=this.getAllFolderPaths();r.addEventListener("input",()=>{let d=r.value.toLowerCase().trim();if(a.empty(),d.length===0){a.hide();return}let g=l.filter(u=>u.toLowerCase().includes(d)&&!this.plugin.settings.excludedFolders.includes(u));if(g.length===0){a.createDiv({cls:"vr-folder-dropdown-item vr-folder-no-result"}).setText("No matching folders"),a.show();return}for(let u of g.slice(0,10)){let v=a.createDiv({cls:"vr-folder-dropdown-item"});v.setText(u),v.addEventListener("click",async()=>{this.plugin.settings.excludedFolders.push(u),await this.plugin.saveSettingsAndReindex(),r.value="",a.hide(),this.display()})}a.show()}),r.addEventListener("blur",()=>{setTimeout(()=>a.hide(),200)});let c=i.createDiv({cls:"vr-folder-selected-list"});this.renderSelectedFolders(c)}renderSelectedFolders(s){if(s.empty(),this.plugin.settings.excludedFolders.length===0){s.createDiv({cls:"vr-folder-empty"}).setText("No folders excluded");return}for(let e of this.plugin.settings.excludedFolders){let i=s.createDiv({cls:"vr-folder-tag"});i.createSpan({text:e,cls:"vr-folder-tag-name"}),i.createSpan({text:"\u2715",cls:"vr-folder-tag-remove"}).addEventListener("click",async()=>{this.plugin.settings.excludedFolders=this.plugin.settings.excludedFolders.filter(n=>n!==e),await this.plugin.saveSettingsAndReindex(),this.display()})}}getAllFolderPaths(){let s=[],e=this.app.vault.getRoot(),i=t=>{for(let n of t.children)n instanceof h.TFolder&&(s.push(n.path),i(n))};return i(e),s.sort()}};var x=require("obsidian");var Q=new Set(["a","an","the","and","or","but","in","on","at","to","for","of","with","by","from","is","it","its","this","that","are","was","were","be","been","being","have","has","had","do","does","did","will","would","could","should","may","might","can","shall","not","no","nor","so","if","then","than","too","very","just","about","above","after","again","all","also","am","any","as","because","before","between","both","each","few","get","got","he","her","here","him","his","how","i","into","like","make","me","more","most","my","new","now","only","other","our","out","over","own","same","she","some","such","up","us","we","what","when","where","which","while","who","whom","why","you","your","there","they","them","their","these","those","through","under","until","well","much","many","still","even","back","down"]);function N(o){return o.toLowerCase().replace(/[^\w\s]/g," ").replace(/\d+/g," ").split(/\s+/).filter(s=>s.length>2&&!Q.has(s)).map(s=>Z(s))}function Z(o){if(o.length<=4)return o;let s=["tion","sion","ment","ness","ible","able","ful","less","ous","ive","ing","ies","ied","ers","est","ity","aly","ely","ize","ise","ify","ate","ent","ant","ary","ery","ory","ly","ed","er","es","al","en"];for(let e of s)if(o.endsWith(e)&&o.length-e.length>=3)return o.slice(0,o.length-e.length);return o.endsWith("s")&&!o.endsWith("ss")&&o.length>3?o.slice(0,-1):o}function P(o){var i;let s=new Map,e=o.length;if(e===0)return s;for(let t of o)s.set(t,((i=s.get(t))!=null?i:0)+1);for(let[t,n]of s)s.set(t,n/e);return s}function V(o){var t;let s=new Map,e=o.length;if(e===0)return s;let i=new Map;for(let n of o)for(let r of n.keys())i.set(r,((t=i.get(r))!=null?t:0)+1);for(let[n,r]of i)s.set(n,Math.log(e/(1+r)));return s}function D(o,s){var i;let e=new Map;for(let[t,n]of o){let r=(i=s.get(t))!=null?i:0,a=n*r;a>0&&e.set(t,a)}return e}function H(o,s){let e=0,i=0,t=0;for(let[r,a]of o){i+=a*a;let l=s.get(r);l!==void 0&&(e+=a*l)}for(let r of s.values())t+=r*r;let n=Math.sqrt(i)*Math.sqrt(t);return n===0?0:e/n}var S=class{constructor(s,e=[],i=".vault-recall"){this.tfMaps=new Map;this.idf=new Map;this.tfidfVectors=new Map;this.indexReady=!1;this.app=s,this.excludedFolders=e,this.indexDir=i}setExcludedFolders(s){this.excludedFolders=s}isReady(){return this.indexReady}async indexVault(){let s=Date.now(),e=this.getMarkdownFiles();if(e.length===0){new x.Notice("Vault Recall: No markdown files found to index.");return}this.tfMaps.clear();for(let n of e){let r=await this.app.vault.cachedRead(n),a=N(this.getIndexableContent(n,r)),l=P(a);this.tfMaps.set(n.path,l)}let i=Array.from(this.tfMaps.values());this.idf=V(i),this.tfidfVectors.clear();for(let[n,r]of this.tfMaps)this.tfidfVectors.set(n,D(r,this.idf));this.indexReady=!0;let t=Date.now()-s;new x.Notice(`Vault Recall: Indexed ${e.length} notes in ${t}ms`)}async indexNote(s){if(!this.indexReady)return;let e=await this.app.vault.cachedRead(s),i=N(this.getIndexableContent(s,e)),t=P(i);this.tfMaps.set(s.path,t);let n=Array.from(this.tfMaps.values());this.idf=V(n),this.tfidfVectors.set(s.path,D(t,this.idf))}removeNote(s){this.tfMaps.delete(s),this.tfidfVectors.delete(s)}findSimilar(s,e=5){if(!this.indexReady)return[];let i=this.tfidfVectors.get(s.path);if(!i)return[];let t=[];for(let[n,r]of this.tfidfVectors){if(n===s.path)continue;let a=H(i,r);a>.01&&t.push({path:n,similarity:a})}return t.sort((n,r)=>r.similarity-n.similarity),t.slice(0,e).map(n=>{let r=this.app.vault.getAbstractFileByPath(n.path);return r instanceof x.TFile?{file:r,similarity:n.similarity}:null}).filter(n=>n!==null)}getIndexedPaths(){return Array.from(this.tfMaps.keys())}getIndexableContent(s,e){let i=s.basename.replace(/[-_]/g," "),t=e.replace(/^---[\s\S]*?---\n?/,"");return t=t.replace(/\[\[([^\]|]+)(?:\|([^\]]+))?\]\]/g,(n,r,a)=>a!=null?a:r),t=t.replace(/\[([^\]]+)\]\([^)]+\)/g,"$1"),t=t.replace(/^#{1,6}\s+/gm,""),t=t.replace(/[*_~`]/g,""),t=t.replace(/^>\s+/gm,""),t=t.replace(/^[-*+]\s+/gm,""),t=t.replace(/^\d+\.\s+/gm,""),`${i} ${i} ${i} ${t}`}getMarkdownFiles(){return this.app.vault.getMarkdownFiles().filter(s=>!this.excludedFolders.some(e=>s.path.startsWith(e+"/")))}async saveIndex(){let s={tfMaps:Object.fromEntries(Array.from(this.tfMaps.entries()).map(([t,n])=>[t,Object.fromEntries(n)])),idf:Object.fromEntries(this.idf),lastIndexed:Date.now()},e=`${this.indexDir}/index.json`,i=JSON.stringify(s);await this.app.vault.adapter.exists(this.indexDir)||await this.app.vault.adapter.mkdir(this.indexDir),await this.app.vault.adapter.write(e,i)}async loadIndex(){let s=`${this.indexDir}/index.json`;try{if(!await this.app.vault.adapter.exists(s))return!1;let e=await this.app.vault.adapter.read(s),i=JSON.parse(e);this.tfMaps.clear();for(let[t,n]of Object.entries(i.tfMaps))this.tfMaps.set(t,new Map(Object.entries(n)));this.idf=new Map(Object.entries(i.idf)),this.tfidfVectors.clear();for(let[t,n]of this.tfMaps)this.tfidfVectors.set(t,D(n,this.idf));return this.indexReady=!0,!0}catch(e){return!1}}};function _(o){return Math.min(Math.max(o,0),1)}function C(o){let e=(Date.now()-o)/(1e3*60*60*24);return 1-Math.exp(-e/20)}function I(o){return o===0?1:o===1?.5:o<=3?.2:0}function O(o,s){let e=o.metadataCache.resolvedLinks,i=0;for(let t in e){let n=e[t];n&&s.path in n&&i++}return i}function A(o,s,e,i={relevance:.5,decay:.35,orphan:.15}){return o*i.relevance+s*i.decay+e*i.orphan}var T=class{constructor(s,e,i=7){this.app=s,this.engine=e,this.minDaysOld=i}async getDailyDigest(s=5){if(!this.engine.isReady())return[];let e=this.getRecentlyModifiedFiles(3);if(e.length===0)return this.getForgottenNotes(s);let i=new Map;for(let n of e){let r=this.engine.findSimilar(n,20);for(let a of r){if(this.getDaysSinceModified(a.file)<this.minDaysOld)continue;let c=i.get(a.file.path);(!c||a.similarity>c.maxSimilarity)&&i.set(a.file.path,{file:a.file,maxSimilarity:a.similarity})}}let t=[];for(let[n,r]of i){let{file:a,maxSimilarity:l}=r,c=this.getDaysSinceModified(a),d=O(this.app,a),g=_(l),u=C(a.stat.mtime),v=I(d),X=A(g,u,v),y="";g>.3?y="Related to your recent work":u>.8?y="Written long ago, might be worth revisiting":v>.5?y="Unlinked note \u2014 consider connecting it":y="Forgotten note worth revisiting";let j=await this.getSnippet(a);t.push({file:a,score:X,reason:y,daysSinceModified:Math.round(c),snippet:j})}return t.sort((n,r)=>r.score-n.score),t.slice(0,s)}getContextualSuggestions(s,e=5){return this.engine.isReady()?this.engine.findSimilar(s,e*3).filter(t=>this.getDaysSinceModified(t.file)>=this.minDaysOld).slice(0,e):[]}async getForgottenNotes(s){let e=this.app.vault.getMarkdownFiles(),i=[];for(let t of e){let n=this.getDaysSinceModified(t);if(n<this.minDaysOld)continue;let r=O(this.app,t),a=C(t.stat.mtime),l=I(r),c=A(.3,a,l),d="";l>.5?d="Unlinked note \u2014 consider connecting it":d=`Not modified in ${Math.round(n)} days`;let g=await this.getSnippet(t);i.push({file:t,score:c,reason:d,daysSinceModified:Math.round(n),snippet:g})}return i.sort((t,n)=>n.score-t.score),i.slice(0,s)}getDaysSinceModified(s){return(Date.now()-s.stat.mtime)/(1e3*60*60*24)}getRecentlyModifiedFiles(s){let e=Date.now()-s*24*60*60*1e3;return this.app.vault.getMarkdownFiles().filter(i=>i.stat.mtime>e).sort((i,t)=>t.stat.mtime-i.stat.mtime).slice(0,10)}async getSnippet(s,e=120){var i;try{let n=(await this.app.vault.cachedRead(s)).replace(/^---[\s\S]*?---\n?/,"").trim();n=n.replace(/^#{1,6}\s+/gm,"");let a=(i=n.split(`
`).filter(l=>l.trim().length>0)[0])!=null?i:"";return a.length<=e?a:a.slice(0,e)+"\u2026"}catch(t){return""}}};var k=class{constructor(s,e=[]){this.app=s,this.excludedFolders=e}setExcludedFolders(s){this.excludedFolders=s}analyze(){let s=this.getMarkdownFiles(),e=this.findOrphanNotes(s),i=this.findBrokenLinks(s),t=this.findEmptyNotes(s),n=this.findDuplicateTitles(s),r=0;for(let l of s){let c=this.app.metadataCache.getFileCache(l);c!=null&&c.links&&(r+=c.links.length)}return{score:this.calculateScore(s.length,e.length,i.length,t.length,n.length),orphanNotes:e,brokenLinks:i,emptyNotes:t,duplicateTitles:n,totalNotes:s.length,totalLinks:r}}findOrphanNotes(s){let e=[],i=this.app.metadataCache.resolvedLinks;for(let t of s){let n=0;for(let r in i){let a=i[r];a&&t.path in a&&n++}n===0&&e.push(t)}return e}findBrokenLinks(s){let e=[];for(let i of s){let t=this.app.metadataCache.getFileCache(i);if(t!=null&&t.links)for(let n of t.links){let r=n.link;this.app.metadataCache.getFirstLinkpathDest(r,i.path)||e.push({sourceFile:i,targetPath:r})}}return e}findEmptyNotes(s){let e=[];for(let i of s)i.stat.size<50&&e.push(i);return e}findDuplicateTitles(s){let e=new Map;for(let t of s){let n=t.basename.toLowerCase(),r=e.get(n);r?r.push(t.path):e.set(n,[t.path])}let i=[];for(let t of e.values())t.length>1&&i.push(t);return i}calculateScore(s,e,i,t,n){if(s===0)return 100;let r=Math.min(e/s*40,30),a=Math.min(i/s*50,25),l=Math.min(t/s*30,20),c=Math.min(n/s*20,10),d=100-r-a-l-c;return Math.max(0,Math.round(d))}getMarkdownFiles(){return this.app.vault.getMarkdownFiles().filter(s=>!this.excludedFolders.some(e=>s.path.startsWith(e+"/")))}};var R=require("obsidian");var m="vault-recall-view",F=class extends R.ItemView{constructor(e,i){super(e);this.activeTab="recall";this.plugin=i}getViewType(){return m}getDisplayText(){return"Vault Recall"}getIcon(){return"brain"}async onOpen(){await this.renderView()}async onClose(){}async refresh(){await this.renderView()}async renderView(){let e=this.containerEl.children[1];if(!e)return;e.empty(),e.addClass("vault-recall-container");let i=e.createDiv({cls:"vr-top-bar"}),t=i.createDiv({cls:"vr-tab-bar"});this.createTab(t,"recall","\u{1F4A1}","Recall"),this.createTab(t,"related","\u{1F517}","Related"),this.createTab(t,"health","\u2764\uFE0F","Health");let n=i.createDiv({cls:"vr-refresh-btn",attr:{"aria-label":"Refresh & reindex"}});(0,R.setIcon)(n,"refresh-cw"),n.addEventListener("click",async()=>{n.addClass("vr-spinning"),await this.plugin.triggerReindex(),n.removeClass("vr-spinning"),await this.renderView()});let r=e.createDiv({cls:"vr-tab-content"});switch(this.activeTab){case"recall":await this.renderRecallTab(r);break;case"related":await this.renderRelatedTab(r);break;case"health":this.renderHealthTab(r);break}}createTab(e,i,t,n){let r=e.createDiv({cls:`vr-tab ${this.activeTab===i?"vr-tab-active":""}`});r.createSpan({text:`${t} ${n}`}),r.addEventListener("click",()=>{this.activeTab=i,this.renderView()})}async renderRecallTab(e){var a,l;let i=e.createDiv({cls:"vr-section-header"});if(i.createEl("h4",{text:"\u{1F4CC} Your Daily Recall"}),i.createEl("p",{text:"Notes you wrote but may have forgotten",cls:"vr-subtitle"}),!((a=this.plugin.engine)!=null&&a.isReady())){let c=e.createDiv({cls:"vr-empty-state"});c.createEl("p",{text:"\u23F3 Indexing vault\u2026"}),c.createEl("p",{text:'Run "Vault Recall: Reindex vault" from the command palette',cls:"vr-subtitle"});return}let t=this.plugin.getEffectiveDigestCount(),n=await((l=this.plugin.resurfacer)==null?void 0:l.getDailyDigest(t));if(!n||n.length===0){let c=e.createDiv({cls:"vr-empty-state"});c.createEl("p",{text:"\u2728 Nothing to resurface right now"}),c.createEl("p",{text:"Keep writing \u2014 notes older than "+this.plugin.settings.minDaysOld+" days will appear here",cls:"vr-subtitle"});return}let r=e.createDiv({cls:"vr-note-list"});for(let c of n)this.renderNoteCard(r,c.file,c.snippet,c.reason,`${c.daysSinceModified}d ago`)}async renderRelatedTab(e){var a,l,c;let i=e.createDiv({cls:"vr-section-header"});if(i.createEl("h4",{text:"\u{1F517} You Wrote About This"}),i.createEl("p",{text:"Forgotten notes related to what you're working on",cls:"vr-subtitle"}),!((a=this.plugin.engine)!=null&&a.isReady())){e.createDiv({cls:"vr-empty-state"}).createEl("p",{text:"\u23F3 Index not ready"});return}let t=this.app.workspace.getActiveFile();if(!t){e.createDiv({cls:"vr-empty-state"}).createEl("p",{text:"\u{1F4DD} Open a note to see related content"});return}let n=(c=(l=this.plugin.resurfacer)==null?void 0:l.getContextualSuggestions(t))!=null?c:[];if(n.length===0){let d=e.createDiv({cls:"vr-empty-state"});d.createEl("p",{text:"\u{1F50D} No forgotten related notes found"}),d.createEl("p",{text:"This note might be new, or related notes were modified recently",cls:"vr-subtitle"});return}let r=e.createDiv({cls:"vr-note-list"});for(let d of n){let g=Math.round((Date.now()-d.file.stat.mtime)/864e5),u=Math.round(d.similarity*100);this.renderNoteCard(r,d.file,"",`${u}% similar`,`${g}d ago`)}}renderHealthTab(e){var r;e.createDiv({cls:"vr-section-header"}).createEl("h4",{text:"\u2764\uFE0F Vault Health"});let t=(r=this.plugin.healthAnalyzer)==null?void 0:r.analyze();if(!t){e.createEl("p",{text:"Unable to analyze vault health"});return}this.renderHealthScore(e,t);let n=e.createDiv({cls:"vr-health-stats"});if(this.renderStatRow(n,"\u{1F4C4}","Total Notes",t.totalNotes.toString()),this.renderStatRow(n,"\u{1F517}","Total Links",t.totalLinks.toString()),this.renderStatRow(n,"\u{1F3DD}\uFE0F","Orphan Notes",t.orphanNotes.length.toString()),this.renderStatRow(n,"\u{1F494}","Broken Links",t.brokenLinks.length.toString()),this.renderStatRow(n,"\u{1F4ED}","Empty Notes",t.emptyNotes.length.toString()),this.renderStatRow(n,"\u{1F46F}","Duplicate Titles",t.duplicateTitles.length.toString()),this.plugin.isPro()||f.fullHealthDetails){if(t.orphanNotes.length>0&&this.renderIssueGroup(e,"\u{1F3DD}\uFE0F Orphan Notes",t.orphanNotes.slice(0,10)),t.brokenLinks.length>0){let a=e.createDiv({cls:"vr-issue-group"});a.createEl("h5",{text:`\u{1F494} Broken Links (${t.brokenLinks.length})`});for(let l of t.brokenLinks.slice(0,10)){let c=a.createDiv({cls:"vr-issue-item"});c.createSpan({text:`${l.sourceFile.basename} \u2192 `,cls:"vr-issue-source"}),c.createSpan({text:l.targetPath,cls:"vr-issue-broken"})}}t.emptyNotes.length>0&&this.renderIssueGroup(e,"\u{1F4ED} Empty Notes",t.emptyNotes.slice(0,10))}else{let a=e.createDiv({cls:"vr-upsell"});a.createEl("p",{text:"\u{1F513} Unlock detailed issue lists with Pro"}),a.createEl("p",{text:"See orphan notes, broken links, and more",cls:"vr-subtitle"});let l=a.createEl("a",{text:"Upgrade to Pro \u2192",href:"https://vastavanjali.gumroad.com/l/nrwpa",cls:"vr-upsell-link"})}}renderHealthScore(e,i){let t=e.createDiv({cls:"vr-health-score"}),n="vr-score-good",r="Healthy";i.score<50?(n="vr-score-bad",r="Needs Work"):i.score<75&&(n="vr-score-warning",r="Fair");let a=t.createDiv({cls:`vr-score-number ${n}`});a.createSpan({text:i.score.toString()}),a.createSpan({text:"/100",cls:"vr-score-max"}),t.createDiv({cls:`vr-score-label ${n}`,text:r})}renderStatRow(e,i,t,n){let r=e.createDiv({cls:"vr-stat-row"});r.createSpan({text:`${i} ${t}`}),r.createSpan({text:n,cls:"vr-stat-value"})}renderIssueGroup(e,i,t){let n=e.createDiv({cls:"vr-issue-group"});n.createEl("h5",{text:`${i} (${t.length})`});for(let r of t){let a=n.createDiv({cls:"vr-issue-item vr-clickable"});a.createSpan({text:r.basename}),a.addEventListener("click",()=>{this.app.workspace.getLeaf(!1).openFile(r)})}}renderNoteCard(e,i,t,n,r){let a=e.createDiv({cls:"vr-note-card"}),l=a.createDiv({cls:"vr-card-title-row"}),c=l.createSpan({text:i.basename,cls:"vr-card-title"});l.createSpan({text:r,cls:"vr-card-age"}),n&&a.createDiv({text:n,cls:"vr-card-badge"}),t&&a.createDiv({text:t,cls:"vr-card-snippet"}),a.addEventListener("click",()=>{this.app.workspace.getLeaf(!1).openFile(i)})}};var W=require("obsidian"),M=class extends W.Modal{constructor(s,e){super(s),this.notes=e}onOpen(){let{contentEl:s}=this;s.addClass("vr-digest-modal");let e=s.createDiv({cls:"vr-digest-header"});e.createEl("h2",{text:"\u{1F9E0} Your Daily Recall"});let i=new Date().toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"});if(e.createEl("p",{text:i,cls:"vr-digest-date"}),this.notes.length===0){let a=s.createDiv({cls:"vr-digest-empty"});a.createEl("p",{text:"\u2728 Nothing to resurface today!"}),a.createEl("p",{text:"All your notes are either too recent or well-connected.",cls:"vr-subtitle"});return}let t=s.createEl("p",{text:`Here are ${this.notes.length} notes you may have forgotten:`,cls:"vr-digest-subtitle"}),n=s.createDiv({cls:"vr-digest-list"});for(let a of this.notes)this.renderDigestCard(n,a);s.createDiv({cls:"vr-digest-footer"}).createEl("p",{text:"\u{1F4A1} Tip: Review these notes to strengthen your knowledge connections",cls:"vr-digest-tip"})}renderDigestCard(s,e){let i=s.createDiv({cls:"vr-digest-card"}),t=i.createDiv({cls:"vr-digest-title-row"});t.createEl("h4",{text:e.file.basename,cls:"vr-digest-note-title"}),t.createSpan({text:`${e.daysSinceModified}d ago`,cls:"vr-digest-age"}),i.createDiv({text:e.reason,cls:"vr-digest-reason"}),e.snippet&&i.createDiv({text:e.snippet,cls:"vr-digest-snippet"});let n=i.createDiv({cls:"vr-digest-actions"});n.createEl("button",{text:"\u{1F4D6} Open",cls:"vr-btn vr-btn-primary"}).addEventListener("click",l=>{l.stopPropagation(),this.app.workspace.getLeaf(!1).openFile(e.file),this.close()}),n.createEl("button",{text:"\u2715 Dismiss",cls:"vr-btn vr-btn-ghost"}).addEventListener("click",l=>{l.stopPropagation(),i.remove()})}onClose(){let{contentEl:s}=this;s.empty()}};var E=class extends p.Plugin{constructor(){super(...arguments);this.engine=null;this.resurfacer=null;this.healthAnalyzer=null;this.licenseManager=new w;this.indexDebounceTimer=null;this.refreshDebounceTimer=null;this.pendingIndexFiles=new Set}async onload(){var t;await this.loadSettings(),await this.licenseManager.validate(this.settings.licenseKey,(t=this.settings.licenseStatus)!=null?t:void 0);let e=this.getExcludedFolders(),i=this.getIndexDir();this.engine=new S(this.app,e,i),this.resurfacer=new T(this.app,this.engine,this.settings.minDaysOld),this.healthAnalyzer=new k(this.app,e),this.registerView(m,n=>new F(n,this)),this.addRibbonIcon("brain","Vault Recall",()=>{this.activateView()}),this.addCommand({id:"open-vault-recall",name:"Open Vault Recall sidebar",callback:()=>this.activateView()}),this.addCommand({id:"reindex-vault",name:"Reindex vault",callback:()=>this.reindexVault()}),this.addCommand({id:"show-daily-digest",name:"Show daily digest",callback:()=>this.showDailyDigest()}),this.addSettingTab(new b(this.app,this)),this.app.workspace.onLayoutReady(async()=>{var n;await this.initializeIndex(),this.settings.showDigestOnStartup&&((n=this.engine)!=null&&n.isReady())&&setTimeout(()=>this.showDailyDigest(),2e3)}),this.registerEvent(this.app.vault.on("modify",n=>{n instanceof p.TFile&&n.extension==="md"&&this.debouncedIndexNote(n)})),this.registerEvent(this.app.vault.on("delete",n=>{var r;n instanceof p.TFile&&((r=this.engine)==null||r.removeNote(n.path))})),this.registerEvent(this.app.vault.on("rename",async(n,r)=>{var a;n instanceof p.TFile&&n.extension==="md"&&((a=this.engine)==null||a.removeNote(r),this.debouncedIndexNote(n))})),this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{this.debouncedRefreshSidebar()}))}onunload(){var e;this.indexDebounceTimer&&clearTimeout(this.indexDebounceTimer),this.refreshDebounceTimer&&clearTimeout(this.refreshDebounceTimer),(e=this.engine)==null||e.saveIndex()}isPro(){return this.licenseManager.isPro()}async activateLicense(e){let i=await this.licenseManager.validate(e);return this.settings.licenseStatus=i,i}deactivateLicense(){this.licenseManager.validate(void 0)}getEffectiveDigestCount(){return this.isPro()?this.settings.digestCount:Math.min(this.settings.digestCount,f.maxDigestCount)}async loadSettings(){this.settings=Object.assign({},$,await this.loadData())}async saveSettingsOnly(){await this.saveData(this.settings)}async saveSettingsAndReindex(){var i,t,n;await this.saveData(this.settings);let e=this.getExcludedFolders();if((i=this.engine)==null||i.setExcludedFolders(e),(t=this.healthAnalyzer)==null||t.setExcludedFolders(e),(n=this.engine)!=null&&n.isReady()){await this.engine.indexVault(),await this.engine.saveIndex();let r=this.getRecallView();r&&await r.refresh()}}async initializeIndex(){if(!this.engine)return;await this.engine.loadIndex()?new p.Notice("Vault Recall: Index loaded from cache"):(await this.engine.indexVault(),await this.engine.saveIndex())}async reindexVault(){if(!this.engine)return;await this.engine.indexVault(),await this.engine.saveIndex();let e=this.getRecallView();e&&await e.refresh()}async triggerReindex(){await this.reindexVault()}debouncedIndexNote(e){this.pendingIndexFiles.add(e.path),this.indexDebounceTimer&&clearTimeout(this.indexDebounceTimer),this.indexDebounceTimer=setTimeout(async()=>{var i;this.indexDebounceTimer=null;for(let t of this.pendingIndexFiles){let n=this.app.vault.getAbstractFileByPath(t);n instanceof p.TFile&&await((i=this.engine)==null?void 0:i.indexNote(n))}this.pendingIndexFiles.clear()},2e3)}debouncedRefreshSidebar(){this.refreshDebounceTimer&&clearTimeout(this.refreshDebounceTimer),this.refreshDebounceTimer=setTimeout(async()=>{this.refreshDebounceTimer=null;let e=this.getRecallView();e&&await e.refresh()},300)}async showDailyDigest(){var t;if(!this.resurfacer||!((t=this.engine)!=null&&t.isReady())){new p.Notice('Vault Recall: Index not ready. Run "Reindex vault" first.');return}let e=this.getEffectiveDigestCount(),i=await this.resurfacer.getDailyDigest(e);new M(this.app,i).open()}async activateView(){let e=this.app.workspace.getLeavesOfType(m);if(e.length>0){this.app.workspace.revealLeaf(e[0]);return}let i=this.app.workspace.getRightLeaf(!1);i&&(await i.setViewState({type:m,active:!0}),this.app.workspace.revealLeaf(i))}getRecallView(){let e=this.app.workspace.getLeavesOfType(m);return e.length>0?e[0].view:null}getIndexDir(){return`${this.app.vault.configDir}/plugins/${this.manifest.id}`}getExcludedFolders(){return this.settings.excludedFolders}};
